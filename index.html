<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Pulse Underground</title><link rel="icon" type="image/jpeg" href="image1.jpeg"><script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script><style>:root{--primary:#7c4dff;--primary-light:#b388ff;--bg-dark:#0d0b14;--bg-light:#13101c;--bg-lighter:#1a1327;--border:#2a2438;--text:#fff;--neon-glow:0 0 5px var(--primary),0 0 10px var(--primary),0 0 15px var(--primary)}*{box-sizing:border-box;margin:0;padding:0}body{font-family:system-ui,-apple-system,sans-serif;background:var(--bg-dark);color:var(--text);line-height:1.5;font-size:16px}#app-container{display:flex;min-height:100vh;max-width:1280px;margin:0 auto}#sidebar-left,#sidebar-right{position:sticky;top:0;height:100vh;background:var(--bg-light);padding:20px;overflow-y:auto}#sidebar-left{width:250px;border-right:1px solid var(--border)}#sidebar-right{width:300px;border-left:1px solid var(--border)}.logo{display:block;margin:0 auto 20px;width:100px}h1{font-size:24px;color:var(--primary-light);text-align:center;margin-bottom:20px}h3{font-size:18px;color:var(--primary-light);margin-bottom:15px}nav ul{list-style:none}nav ul li{margin-bottom:10px}nav a{display:flex;align-items:center;color:var(--text);text-decoration:none;padding:10px;border-radius:8px;transition:background .2s,box-shadow .2s}nav a:hover{background:var(--bg-lighter);box-shadow:var(--neon-glow)}.icon{width:20px;height:20px;margin-right:15px;filter:drop-shadow(0 0 2px var(--primary))}main{flex-grow:1;width:calc(1280px - 550px);background:var(--bg-light);border:1px solid var(--border);padding:20px}button,#publishStory,#loadMoreButton{width:100%;padding:12px;background:linear-gradient(45deg,var(--primary),var(--primary-light));color:var(--text);border:none;border-radius:8px;font-weight:bold;cursor:pointer;transition:background .3s,box-shadow .3s;margin-bottom:15px}button:hover{background:linear-gradient(45deg,#6a3fff,#a370ff);box-shadow:var(--neon-glow)}button:disabled{opacity:.6;cursor:not-allowed}#publishStory{position:absolute;bottom:10px;right:10px;width:40px;height:40px;border-radius:50%;padding:0;display:flex;align-items:center;justify-content:center}#loadMoreButton{width:auto;padding:8px 20px;font-size:14px;margin:20px auto;display:none}#storySubmission{display:flex;padding:15px;background:var(--bg-lighter);border-bottom:1px solid var(--border);margin-bottom:20px}.avatar{width:48px;height:48px;border-radius:50%;margin-right:15px}.input-container{flex-grow:1;position:relative}textarea{width:100%;min-height:100px;padding:15px;background:var(--bg-light);border:1px solid var(--border);border-radius:8px;color:var(--text);resize:none}textarea:focus{outline:none;border-color:var(--primary);box-shadow:var(--neon-glow)}.news-item{padding:15px;border-bottom:1px solid var(--border);transition:background .2s}.news-item:hover{background:var(--bg-lighter)}.reporter-info{display:flex;align-items:center;margin-bottom:10px}.reporter-details{font-size:14px;margin-left:10px}.reporter-name{font-weight:bold}.report-content{margin:10px 0;line-height:1.6}#searchInput,#customChannelInput{width:100%;padding:12px 15px;background:var(--bg-lighter);border:1px solid var(--border);border-radius:20px;color:var(--text);margin-bottom:20px}#searchInput:focus,#customChannelInput:focus{outline:none;border-color:var(--primary);box-shadow:var(--neon-glow)}#loadingOverlay,#profileModal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(13,11,20,.8);color:var(--text);display:none;justify-content:center;align-items:center;z-index:1000}#statusMessage{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:var(--bg-light);padding:10px 20px;border-radius:5px;display:none;z-index:1001;box-shadow:var(--neon-glow)}#channelSelection{margin-top:20px}#currentChannel{font-size:14px;color:var(--text);margin-top:10px}.modal-content{background:var(--bg-light);padding:20px;border-radius:8px;width:400px;max-width:90%;border:1px solid var(--border)}.modal-content h2{color:var(--primary-light);margin-bottom:20px}.modal-content label{display:block;margin-bottom:10px;font-size:14px}.modal-content input{width:100%;padding:10px;margin-bottom:15px;background:var(--bg-lighter);border:1px solid var(--border);border-radius:5px;color:var(--text)}.modal-content img{width:100px;height:100px;border-radius:50%;margin-bottom:15px;display:block;margin-left:auto;margin-right:auto}.modal-buttons{display:flex;gap:10px}#activeChannels h3{font-size:18px;color:var(--primary-light);margin-bottom:15px}#activeChannels p{font-size:14px;color:var(--text);margin-top:10px}</style></head><body><div id="app-container"><div id="sidebar-left"><img src="image1.jpeg" class="logo"><nav><ul><li><a id="h"><span class="icon"><svg width="20" height="20" viewBox="0 0 24 24" stroke="var(--primary-light)"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V9zM9 22V12h6v10"/></svg></span>Home</a></li><li><a><span class="icon"><svg width="20" height="20" viewBox="0 0 24 24" stroke="var(--primary-light)"><path d="M21 21l-6-6m2-5a7 7 0 1 0-14 0 7 7 0 0 0 14 0z"/></svg></span>Explore</a></li><li><a><span class="icon"><svg width="20" height="20" viewBox="0 0 24 24" stroke="var(--primary-light)"><path d="M12 22c5.5 0 10-4.5 10-10S17.5 2 12 2 2 6.5 2 12s4.5 10 10 10zM12 8v4M12 16h.01"/></svg></span>Notifications</a></li><li><a><span class="icon"><svg width="20" height="20" viewBox="0 0 24 24" stroke="var(--primary-light)"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2zM22 6l-10 7L2 6"/></svg></span>Messages</a></li><li><a id="pl"><span class="icon"><svg width="20" height="20" viewBox="0 0 24 24" stroke="var(--primary-light)"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2M12 7c0 2.2-1.8 4-4 4s-4-1.8-4-4 1.8-4 4-4 4 1.8 4 4z"/></svg></span>Profile</a></li></ul></nav><button id="w">Connect Wallet</button><div id="wi" style="display:none"><span id="wa"></span></div></div><main><h1>The Pulse Underground</h1><div id="storySubmission"><img src="image1.jpeg" class="avatar" id="sa"><div class="input-container"><textarea id="r" placeholder="What's happening?"></textarea><button id="p">➤</button></div></div><div id="f"></div><button id="b">Load More</button></main><div id="sidebar-right"><input id="s" placeholder="Search The Pulse Underground"><div id="channelSelection"><h3>Channels</h3><button id="m">Main</button><button id="sl">Self</button><input id="ci" placeholder="Enter custom address"><button id="sc">Custom</button><p>Current Channel: <span id="cc"></span></p></div><div id="activeChannels"><h3>Active Channels</h3><p>Coming soon...</p></div></div></div><div id="loadingOverlay" style="display:none">Loading...</div><div id="statusMessage" style="display:none"></div><div id="pm" style="display:none"><div class="modal-content"><h2>Edit Profile</h2><img src="image1.jpeg" id="pp"><label for="ui">Username:</label><input id="ui" placeholder="Enter username"><label for="pi">Profile Picture URL:</label><input id="pi" placeholder="Enter image URL"><div class="modal-buttons"><button id="sp">Save</button><button id="cp">Clear</button><button id="cm">Close</button></div></div></div><script>const e=window.ethers,m="0x9Cd83BE15a79646A3D22B81fc8dDf7B7240a62cB".toLowerCase(),p=369;class C{constructor(){this.d=null,this.r=!1,console.log("Cache initializing"),this.i().then(()=>(this.r=!0,console.log("Cache ready")))}async i(){return new Promise(r=>(q=indexedDB.open("PulseUndergroundCache",2),q.onupgradeneeded=e=>(d=e.target.result,d.objectStoreNames.contains("newsItems")||d.createObjectStore("newsItems",{keyPath:"txHash"}),d.objectStoreNames.contains("profiles")||d.createObjectStore("profiles",{keyPath:"address"})),q.onsuccess=()=>(this.d=q.result,r()),q.onerror=()=>(document.getElementById("statusMessage").textContent="IndexedDB Error",document.getElementById("statusMessage").style.display="block",setTimeout(()=>(document.getElementById("statusMessage").style.display="none"),3e3))))}async w(){while(!this.r)await new Promise(r=>setTimeout(r,100))}async o(t,a,m,p){await this.w();if(!this.d)return console.error("DB null in",m),p?null:void 0;const s=this.d.transaction(t,"readwrite"),q=s.objectStore(t);return"put"===m?a.forEach(j=>q.put(j)):"get"===m?new Promise((r,e)=>(v=q.get(a),v.onsuccess=()=>r(v.result),v.onerror=()=>e(v.error))):"delete"===m&&q.delete(a),new Promise((r,e)=>(s.oncomplete=r,s.onerror=()=>(e(s.error),console.error(m,"error:",s.error))))}}class P{constructor(){this.s={n:[],t:"",l:!1,x:null,c:m,p:{u:"",i:"image1.jpeg"},a:null},this.e={f:document.getElementById("f"),r:document.getElementById("r"),s:document.getElementById("s"),b:document.getElementById("b"),w:document.getElementById("w"),wi:document.getElementById("wi"),wa:document.getElementById("wa"),p:document.getElementById("p"),m:document.getElementById("m"),sl:document.getElementById("sl"),ci:document.getElementById("ci"),sc:document.getElementById("sc"),cc:document.getElementById("cc"),sa:document.getElementById("sa"),pl:document.getElementById("pl"),pm:document.getElementById("pm"),ui:document.getElementById("ui"),pi:document.getElementById("pi"),pp:document.getElementById("pp"),sp:document.getElementById("sp"),cp:document.getElementById("cp"),cm:document.getElementById("cm"),h:document.getElementById("h")},console.log("Elements initialized:",!!this.e.f,!!this.e.b),this.k=new C,this.g=null}async init(){console.log("Init: start"),await this.k.w(),console.log("Init: cache ready"),await this.k.o("newsItems",[],"put"),console.log("Init: cache cleared"),console.log("Init: cache load start"),this.s.n=(await new Promise((r,e)=>{let t=this.k.d?.transaction("newsItems","readonly");let s=t?.objectStore("newsItems");let q=s?.getAll();q.onsuccess=()=>r(q.result||[]);q.onerror=()=>e(q.error);}))||[],console.log("Init: cache load complete"),console.log("Init: loaded",this.s.n.length,"items"),this.r(),this.l(),this.e.cc.textContent=this.s.c.slice(0,6)+"..."+this.s.c.slice(-4),console.log("Fetch start"),await this.q(33,!0)}l(){const e=this.e,s=document.getElementById("statusMessage");e.w.onclick=()=>this.t(),e.p.onclick=()=>this.u(),e.s.oninput=()=>(clearTimeout(this.dt),setTimeout(()=>(this.s.t=e.s.value.trim().toLowerCase(),this.r()),300)),e.b.onclick=()=>this.q(this.s.n.length+33,!1),e.h.onclick=e=>(e.preventDefault(),window.scrollTo({top:0,behavior:"smooth"})),e.m.onclick=async()=>(this.s.n.length=0,this.s.x=null,await this.k.o("newsItems",[],"put"),this.s.c=m,this.r(),e.cc.textContent=m.slice(0,6)+"..."+m.slice(-4),this.q(33,!0)),e.sl.onclick=async()=>(this.g?(a=(await this.g.getAddress()).toLowerCase(),this.s.n.length=0,this.s.x=null,await this.k.o("newsItems",[],"put"),this.s.c=a,this.r(),e.cc.textContent=a.slice(0,6)+"..."+a.slice(-4),this.q(33,!0)):(s.textContent="Connect wallet first",s.style.display="block",setTimeout(()=>(s.style.display="none"),3e3))),e.sc.onclick=async()=>(a=e.ci.value.trim().toLowerCase(),e.utils.isAddress(a)?(this.s.n.length=0,this.s.x=null,await this.k.o("newsItems",[],"put"),this.s.c=a,this.r(),e.cc.textContent=a.slice(0,6)+"..."+a.slice(-4),this.q(33,!0)):(s.textContent="Invalid address",s.style.display="block",setTimeout(()=>(s.style.display="none"),3e3))),e.pl.onclick=async()=>(this.g?(e.pm.style.display="flex",p=this.s.p,e.ui.value=p.u,e.pi.value="image1.jpeg"!==p.i?p.i:"",e.pp.src=p.i):(s.textContent="Connect wallet first",s.style.display="block",setTimeout(()=>(s.style.display="none"),3e3))),e.sp.onclick=async()=>(n=e.ui.value.trim(),i=e.pi.value.trim()||"image1.jpeg","image1.jpeg"!==i&&!(await new Promise(r=>(m=new Image(),m.src=i,m.onload=()=>r(!0),m.onerror=()=>r(!1))))?(s.textContent="Invalid URL",s.style.display="block",setTimeout(()=>(s.style.display="none"),3e3)):(this.s.p={u:n,i},await this.k.o("profiles",{address:this.s.a,u:n,i},"put"),e.sa.src=i,e.pm.style.display="none",this.r(),s.textContent="Profile saved",s.style.display="block",setTimeout(()=>(s.style.display="none"),3e3))),e.cp.onclick=async()=>(await this.k.o("profiles",this.s.a,"delete"),this.s.p={u:"",i:"image1.jpeg"},e.sa.src="image1.jpeg",e.pm.style.display="none",this.r(),s.textContent="Profile cleared",s.style.display="block",setTimeout(()=>(s.style.display="none"),3e3)),e.cm.onclick=()=>e.pm.style.display="none",e.pi.oninput=()=>(u=e.pi.value.trim()||"image1.jpeg",i=new Image(),i.src=u,i.onload=()=>e.pp.src=u,i.onerror=()=>e.pp.src="image1.jpeg")}async t(){const{wi,w,wa,sa}=this.e,s=document.getElementById("statusMessage");if(this.g)this.g=null,this.s.a=null,wi.style.display="none",w.textContent="Connect Wallet",wa.textContent="",sa.src="image1.jpeg",this.s.p={u:"",i:"image1.jpeg"},this.r(),s.textContent="Wallet disconnected",s.style.display="block",setTimeout(()=>(s.style.display="none"),3e3);else{if(!window.ethereum)return s.textContent="MetaMask not detected",s.style.display="block",setTimeout(()=>(s.style.display="none"),3e3);try{const t=new e.providers.Web3Provider(window.ethereum);(await t.getNetwork()).chainId!==p&&await window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:"0x171"}]}),await t.send("eth_requestAccounts",[]),this.g=t.getSigner(),this.s.a=(await this.g.getAddress()).toLowerCase(),this.s.p=await this.k.o("profiles",this.s.a,"get",!0)||{u:"",i:"image1.jpeg"},wa.textContent=this.s.a.slice(0,6)+"..."+this.s.a.slice(-4),wi.style.display="block",w.textContent="Disconnect Wallet",sa.src=this.s.p.i,s.textContent="Wallet connected",s.style.display="block",setTimeout(()=>(s.style.display="none"),3e3)}catch(e){s.textContent="Connection failed: "+e.message,s.style.display="block",setTimeout(()=>(s.style.display="none"),3e3)}}}async u(){const{r,b}=this.e,c=r.value.trim(),s=document.getElementById("statusMessage");if(!this.g)return s.textContent="Connect wallet first",s.style.display="block",setTimeout(()=>(s.style.display="none"),3e3);if(!c)return s.textContent="Content cannot be empty",s.style.display="block",setTimeout(()=>(s.style.display="none"),3e3);b.disabled=!0,document.getElementById("loadingOverlay").style.display="flex";try{const n={c,reporter:this.s.a,timestamp:new Date().toISOString(),txHash:(await this.g.sendTransaction({to:this.s.c,value:0,data:e.utils.hexlify(e.utils.toUtf8Bytes(c)),gasLimit:15e4})).hash};this.s.n.unshift(n),await this.k.o("newsItems",[n],"put"),r.value="",this.r(),s.textContent=`Published: ${n.txHash.slice(0,6)}...${n.txHash.slice(-4)}`,s.style.display="block",setTimeout(()=>(s.style.display="none"),3e3)}catch(e){s.textContent="Publish failed: "+e.message,s.style.display="block",setTimeout(()=>(s.style.display="none"),3e3)}finally{b.disabled=!1,document.getElementById("loadingOverlay").style.display="none"}}async q(t,i){const n=this.s.n,{b,f}=this.e,s=document.getElementById("statusMessage");if(this.s.l||!b||!f)return console.error("loadMoreButton or newsFeed undefined");b.disabled=!0,document.getElementById("loadingOverlay").style.display="flex",this.s.l=!0;try{console.log("Fetch posts, target:",t,"current:",n.length,"initial:",i),i&&(n.length=0);const c=t-n.length;if(c<=0&&!i)return;console.log("Fetch start");let p=0;while(c>0&&this.s.x){const u=`https://api.scan.pulsechain.com/api/v2/addresses/${this.s.c}/transactions?limit=33${this.s.x?`&${new URLSearchParams(this.s.x)}`:""}`;console.log("Fetch attempt:",u),console.log("API limit requested: 33");const r=await fetch(u);console.log("Fetch completed:",r.status);if(!r.ok){const t=await r.text().catch(()=>"");throw new Error(`API error: ${r.status} ${t}`)}const d=await r.json();console.log("API items received:",d.items?.length||0),console.log("Parse start:",d.items?.length||0);const q=[];let k=0;for(const t of d.items||[]){if(!t.raw_input||"0x"===t.raw_input){k++;continue}try{const c=e.utils.toUtf8String(t.raw_input)||t.raw_input;if(c===t.raw_input&&c.startsWith("0x")){k++;continue}console.log("Transaction:",t.hash,"input:",c),q.push({c,reporter:t.from?.hash||t.from,timestamp:t.timestamp||new Date().toISOString(),txHash:t.hash})}catch(e){console.error("Parse error for",t.hash,":",e.message),k++}}console.log("Skipped:",k,"invalid transactions"),console.log("Parsed posts:",q.length),this.s.x=d.next_page_params,console.log("Fetched:",q.length,"nextPageParams:",this.s.x);const h=new Map(n.map(j=>[j.txHash,!0])),w=i?q.slice(0,33).filter(o=>!h.has(o.txHash)):q.filter(o=>!h.has(o.txHash)).slice(0,c);console.log("Posts added:",w.length),n.push(...w.sort((a,b)=>new Date(b.timestamp)-new Date(a.timestamp))),await this.k.o("newsItems",w,"put"),c-=w.length,p+=w.length,console.log("News items updated:",n.length)}this.r(),!p&&i&&this.s.x||(s.textContent="No posts found",s.style.display="block",setTimeout(()=>(s.style.display="none"),3e3))}catch(e){console.error("Fetch error:",e.message),s.textContent="Fetch failed: "+e.message,s.style.display="block",setTimeout(()=>(s.style.display="none"),3e3)}finally{this.s.l=!1,b.disabled=!1,document.getElementById("loadingOverlay").style.display="none",i||n.length&&window.scrollTo({top:0,behavior:"smooth"})}}r(){const{n,t,a,p}=this.s,{f,b}=this.e;console.log("Render attempt, searchTerm:",t,"items:",n.length),f&&b?(f.innerHTML="",n.length?(d=document.createDocumentFragment(),q=t.trim().toLowerCase(),w=n.filter(i=>!q||i.c.toLowerCase().includes(q)||i.reporter.toLowerCase().includes(q)),w.forEach(i=>(e=document.createElement("div"),e.className="news-item",r=i.reporter.toLowerCase()===a,e.innerHTML=`<div class="reporter-info"><img src="${r&&p.i?p.i:"image1.jpeg"}" class="avatar"><div class="reporter-details"><span class="reporter-name">${r&&p.u?p.u:i.reporter.slice(0,6)+"..."+i.reporter.slice(-4)}</span> · ${new Date(i.timestamp).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})}</div></div><div class="report-content">${i.c.replace(/\n/g,"<br>")}</div>`,d.appendChild(e))),console.log("Filtered:",w.length,"posts"),f.appendChild(d),f.innerHTML=w.length?f.innerHTML:"No posts available.",b.style.display=w.length&&this.s.x?"block":"none",b.textContent=w.length?"Load More":"Top",b.disabled=this.s.l,console.log("Button state, items:",n.length,"filtered:",w.length,"isLoading:",this.s.l)):(console.log("Render skipped: no items"),f.innerHTML="No posts available.",b.style.display="none",b.textContent="Top",b.disabled=this.s.l,console.log("Button state, items:",n.length,"filtered: 0, isLoading:",this.s.l))):console.error("newsFeed or loadMoreButton undefined")}new P().init();</script></body></html>
