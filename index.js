const D={A:'0xD9157453E2668B2fc45b7A803D3FEF3642430cC0',B:[{inputs:[{name:"_queryId",type:"bytes32"},{name:"_value",type:"bytes"},{name:"_nonce",type:"uint256"},{name:"_queryData",type:"bytes"}],name:"submitValue",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{name:"_queryId",type:"bytes32"}],name:"getNewValueCountbyQueryId",outputs:[{name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"getStakeAmount",outputs:[{name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{name:"_stakerAddress",type:"address"}],name:"getStakerInfo",outputs:[{name:"",type:"uint256"},{name:"",type:"uint256"},{name:"",type:"uint256"},{name:"",type:"uint256"},{name:"",type:"uint256"},{name:"",type:"uint256"},{name:"",type:"uint256"},{name:"",type:"uint256"},{name:"",type:"bool"}],stateMutability:"view",type:"function"}],u:'api.scan.pulsechain.com/api/v2/addresses/',b:100,m:10,r:3,t:3e5,c:'0x434F4D4D454E54'},A=function(){this.e=window.ethers,this.s={i:[],l:0,n:0,p:null,r:new Set,t:0,a:0},this._=document.getElementById.bind(document),this.setup(),this.cache=new P,this.cache.init().then(()=>this.f(!0)).catch(console.error)},A.prototype={setup:setup,ps:ps,tx:tx,se:se,c:c,f:f,p:p,r:r,w:w,sh:sh,dt:dt,t:t,g:g,hm:hm};new A;import{setup,ps,tx,se,c,f,p,r,w,sh,dt,t,g,hm}from'./data.js';function setup(){const s=this;document.body.insertAdjacentHTML('beforeend','<div id=m class="modal"><div id=n class="modal-content"><button class=x>Ã—</button><div id=r class="original-post"></div><div id=s class="comments-section"><div id=l class="comments-list"></div><div class=i><textarea id=t placeholder="Write a comment..."></textarea><button id=cs>ðŸ’¬</button></div></div></div><div id=o class="status-message"></div>'),document.addEventListener('click',e=>{const t=e.target;if(!t)return;if(t.classList.contains('x')){s.hm()}else if(t.matches('.action-btn')){const p=t.closest('.report-actions'),d=p?.dataset;d&&(t.dataset.action==='comment'?s.sm(d.queryId):t.dataset.action==='dispute'&&window.disputeNews&&window.disputeNews(d.reporter,d.queryId,d.timestamp))}else{const i=t.id;i==='connectWallet'?s.w():i==='publishStory'?s.ps():i==='loadMoreButton'?s.c():i==='cs'?s.pc():i==='search-button'&&s.se()}});const x=this._('t');x&&new ResizeObserver(()=>requestAnimationFrame(()=>x.style.height=x.scrollHeight+'px')).observe(x);const i=this._('search-input');i&&(i.addEventListener('keypress',e=>e.key==='Enter'&&s.se()),i.addEventListener('input',e=>{const v=e.target.value.trim();!v&&s.s.a&&(s.s.a=0,s.r(s.s.i),s._('loadMoreButton').style.display='none')}));window.addEventListener('scroll',()=>{!s.s.l&&!s.s.n&&!s.s.a&&window.innerHeight+window.scrollY>=document.documentElement.scrollHeight-500&&s.c()});this._('loadMoreButton').style.display='none',setInterval(()=>s.c(),D.t)}async function w(){try{if(!window.ethereum)throw'Please install MetaMask';const p=new this.e.providers.Web3Provider(window.ethereum);await p.send('eth_requestAccounts',[]);const s=p.getSigner(),a=await s.getAddress();this._('connectWallet').style.display='none',this._('walletInfo').style.display='block',this._('walletAddress').textContent=this.sh(a),this._('publishStory').disabled=!1,this._('reportContent').placeholder="What's happening?",this.contract=new this.e.Contract(D.A,D.B,s),this.signer=s,this.t('Connected')}catch(e){console.error('Wallet error:',e),this.t(e.message==='User rejected the request.'?'Connection cancelled':e.message||'Failed to connect wallet')}}async function tx(p){const u=`https://${D.u}${D.A}/transactions?filter=to&sort=desc&limit=${D.b}${p?'&'+new URLSearchParams(p):''}`;if(this.s.r.has(u))return new Promise(r=>setTimeout(()=>r(this.tx(p)),100));this.s.r.add(u);try{return await(await fetch(u)).json()}catch(e){throw console.error('API Error:',e),e}finally{this.s.r.delete(u)}}
